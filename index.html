<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assistir Junto Privado PRO</title>

<style>
*{box-sizing:border-box;}
body{
margin:0;
font-family:Arial, Helvetica, sans-serif;
background:#0f0f0f;
color:white;
display:flex;
justify-content:center;
}
.hidden{display:none;}
.card{
width:95%;
max-width:700px;
margin:40px auto;
background:#181818;
padding:25px;
border-radius:16px;
box-shadow:0 0 25px rgba(0,0,0,0.6);
}
h1{text-align:center;margin-bottom:10px;font-size:22px;}
.online{text-align:center;font-size:14px;margin-bottom:5px;color:#bbb;}
.global-online{text-align:center;font-size:13px;margin-bottom:15px;color:#00ff88;}
.creator{
margin-top:20px;
font-size:12px;
color:#888;
text-align:center;
}
.creator a{color:#e50914;text-decoration:none;}
input{
width:100%;
padding:14px;
border:none;
border-radius:10px;
background:#2a2a2a;
color:white;
font-size:14px;
margin-bottom:12px;
}
.btn{
width:100%;
padding:14px;
background:#e50914;
color:white;
border:none;
border-radius:10px;
font-size:14px;
cursor:pointer;
margin-bottom:15px;
}
.btn-secondary{background:#333;}
.video-box{
width:100%;
background:#d9d9d9;
border-radius:12px;
overflow:hidden;
position:relative;
margin-bottom:20px;
}
.video-wrapper{
position:relative;
width:100%;
padding-top:56.25%;
}
.video-wrapper iframe,
.video-wrapper video{
position:absolute;
top:0;
left:0;
width:100%;
height:100%;
border:none;
object-fit:cover;
}
.chat{
background:#111;
border-radius:12px;
padding:15px;
max-height:280px;
display:flex;
flex-direction:column;
margin-bottom:15px;
}
#chatBox{flex:1;overflow-y:auto;margin-bottom:10px;}
.msg{
background:#222;
padding:8px 12px;
border-radius:8px;
margin-bottom:8px;
font-size:13px;
word-break:break-word;
}
.msg strong{color:#e50914;}
.btn-sair{
width:100%;
padding:12px;
background:#444;
color:white;
border:none;
border-radius:10px;
font-size:14px;
cursor:pointer;
}
.login, .home{
width:95%;
max-width:500px;
margin:100px auto;
background:#181818;
padding:30px;
border-radius:16px;
text-align:center;
}
.home p{
font-size:14px;
color:#ccc;
margin-bottom:15px;
line-height:1.6;
}
</style>
</head>
<body>

<div class="home" id="homeBox">
<h2>游꿟 Assistir Junto Privado PRO</h2>
<p><strong>Como funciona?</strong></p>
<p>
游댏 Voc칡 cria ou entra em uma sala usando uma senha.<br>
游꿘 Pode enviar link do YouTube ou v칤deo .mp4.<br>
游늬 Pode enviar v칤deo da galeria.<br>
游눫 Conversa em tempo real.<br>
游논 S칩 entra quem souber a senha.
</p>
<button class="btn" onclick="abrirLogin()">Entrar na Sala</button>
<div class="global-online" id="totalOnlineGlobal">Usu치rios no site: 0</div>
<div class="creator">
Criador: <strong>Isac Santos</strong><br>
Instagram: <a href="https://instagram.com/nini.vuhh" target="_blank">@nini.vuhh</a>
</div>
</div>

<div class="login hidden" id="loginBox">
<h2>游댏 Entrar na Sala</h2>
<input type="text" id="nomeUsuario" placeholder="Seu nome">
<input type="password" id="senhaSala" placeholder="Senha da sala">
<button class="btn" id="btnEntrar">Entrar</button>
<button class="btn btn-secondary" onclick="voltarHome()">Voltar</button>
</div>

<div class="card hidden" id="salaBox">
<h1>游꿟 Sala Privada</h1>
<div class="online" id="onlineInfo">Online na sala: 0</div>
<div class="global-online" id="globalSala">Usu치rios no site: 0</div>

<input type="text" id="linkInput" placeholder="Link YouTube ou .mp4">
<button class="btn" id="btnEnviarVideo">Enviar V칤deo</button>
<input type="file" id="videoFile" accept="video/*" class="btn">

<div class="video-box">
<div class="video-wrapper" id="videoArea"></div>
</div>

<h3>Bate-Papo</h3>
<div class="chat">
<div id="chatBox"></div>
<input type="text" id="chatInput" placeholder="Mensagem">
<button class="btn" id="btnEnviarMsg">Enviar</button>
</div>

<button class="btn-sair" onclick="sairSala()">Sair da Sala</button>

<div class="creator">
Criador: <strong>Isac Santos</strong> |
Instagram: <a href="https://instagram.com/nini.vuhh" target="_blank">@nini.vuhh</a>
</div>
</div>

<audio id="notifSound">
<source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg">
</audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc, deleteDoc, arrayUnion, arrayRemove, increment } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyBFX1DJmROOkPXYgras6Z1kFOWj2y33agY",
authDomain:"salaprivada-a0df7.firebaseapp.com",
projectId:"salaprivada-a0df7"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let salaRef=null;
let nomeLocal="";
let donoSala="";
let ultimoVideo="";
let ultimoChatTamanho=0;

window.abrirLogin=()=>{homeBox.classList.add("hidden");loginBox.classList.remove("hidden");}
window.voltarHome=()=>{loginBox.classList.add("hidden");homeBox.classList.remove("hidden");}

const globalRef=doc(db,"site","online");

async function entrarSite(){
let snap=await getDoc(globalRef);
if(!snap.exists()) await setDoc(globalRef,{total:0});
await updateDoc(globalRef,{total:increment(1)});
}

async function sairSite(){
await updateDoc(globalRef,{total:increment(-1)});
}

onSnapshot(globalRef,(snap)=>{
let dados=snap.data();
if(dados){
totalOnlineGlobal.innerText="Usu치rios no site: "+dados.total;
if(globalSala)globalSala.innerText="Usu치rios no site: "+dados.total;
}
});

entrarSite();

btnEntrar.onclick=async()=>{
let senha=senhaSala.value.trim();
let nome=nomeUsuario.value.trim();
if(!senha||!nome){alert("Preencha tudo");return;}

nomeLocal=nome;
salaRef=doc(db,"salas",senha);

let snap=await getDoc(salaRef);

if(!snap.exists()){
await setDoc(salaRef,{video:"",chat:[],online:[],dono:nomeLocal});
donoSala=nomeLocal;
}else{
donoSala=snap.data().dono;
}

await updateDoc(salaRef,{online:arrayUnion(nomeLocal)});

loginBox.classList.add("hidden");
salaBox.classList.remove("hidden");

onSnapshot(salaRef,(docSnap)=>{
let dados=docSnap.data();
if(!dados)return;

donoSala=dados.dono;

if(dados.video && dados.video!==ultimoVideo){
ultimoVideo=dados.video;
carregarVideo(dados.video);
}

if(dados.chat && dados.chat.length!==ultimoChatTamanho){
ultimoChatTamanho=dados.chat.length;
mostrarChat(dados.chat);
}

onlineInfo.innerText="Online na sala: "+(dados.online?dados.online.length:0);

if(nomeLocal!==donoSala){
btnEnviarVideo.disabled=true;
videoFile.disabled=true;
btnEnviarVideo.style.opacity="0.5";
videoFile.style.opacity="0.5";
}else{
btnEnviarVideo.disabled=false;
videoFile.disabled=false;
btnEnviarVideo.style.opacity="1";
videoFile.style.opacity="1";
}
});
};

async function sairSala(){
if(!salaRef){ location.reload(); return; }

let snap=await getDoc(salaRef);
if(!snap.exists()){ location.reload(); return; }

let dados=snap.data();

await updateDoc(salaRef,{
online:arrayRemove(nomeLocal)
});

let novoSnap=await getDoc(salaRef);
let novoDados=novoSnap.data();

if(novoDados.online.length===0){
await deleteDoc(salaRef);
}
else if(dados.dono===nomeLocal){
await updateDoc(salaRef,{dono:novoDados.online[0]});
}

await sairSite();
location.reload();
}

btnEnviarMsg.onclick=async()=>{
let texto=chatInput.value.trim();
if(!texto)return;
await updateDoc(salaRef,{chat:arrayUnion({nome:nomeLocal,msg:texto})});
chatInput.value="";
};

function mostrarChat(lista){
chatBox.innerHTML="";
lista.forEach(item=>{
let div=document.createElement("div");
div.className="msg";
let nomeExibido=item.nome===donoSala?"游녬 "+item.nome:item.nome;
div.innerHTML="<strong>"+nomeExibido+":</strong> "+item.msg;
chatBox.appendChild(div);
});
chatBox.scrollTop=chatBox.scrollHeight;
notifSound.currentTime=0;
notifSound.play();
}

btnEnviarVideo.onclick=async()=>{
if(nomeLocal!==donoSala){alert("S칩 o dono pode enviar v칤deo");return;}
let link=linkInput.value.trim();
if(!link)return;
await updateDoc(salaRef,{video:link});
linkInput.value="";
};

videoFile.onchange=async(e)=>{
if(nomeLocal!==donoSala){alert("S칩 o dono pode enviar v칤deo");return;}
const file=e.target.files[0];
if(!file)return;
const url=URL.createObjectURL(file);
await updateDoc(salaRef,{video:url});
};

function carregarVideo(link){
videoArea.innerHTML="";
if(link.includes("youtu")){
let id="";
if(link.includes("watch?v=")){
id=link.split("watch?v=")[1].split("&")[0];
}else{
id=link.split("youtu.be/")[1].split("?")[0];
}
let iframe=document.createElement("iframe");
iframe.src="https://www.youtube.com/embed/"+id;
iframe.allowFullscreen=true;
videoArea.appendChild(iframe);
}else{
let video=document.createElement("video");
video.src=link;
video.controls=true;
video.autoplay=true;
videoArea.appendChild(video);
}
}
</script>

</body>
</html>
